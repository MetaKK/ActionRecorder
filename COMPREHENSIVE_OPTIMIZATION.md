# ğŸš€ Life Recorder - å…¨é¢æ¶æ„ä¸æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

> åŸºäºä¸šå†…æœ€ä½³å®è·µï¼Œå…¨æ–¹ä½æå‡åº”ç”¨æ€§èƒ½ã€å¯ç»´æŠ¤æ€§å’Œç”¨æˆ·ä½“éªŒ

---

## ğŸ“Š å½“å‰æ¶æ„åˆ†æ

### âœ… å·²å®æ–½çš„ä¼˜åŒ–
1. **åŠ¨æ€å¯¼å…¥** - page.tsxä¸­ä½¿ç”¨äº†dynamic import
2. **å­—ä½“ä¼˜åŒ–** - ä½¿ç”¨font-display: swap
3. **ç¼–è¯‘ä¼˜åŒ–** - ç”Ÿäº§ç¯å¢ƒç§»é™¤console
4. **åŒ…ä¼˜åŒ–** - optimizePackageImportsé…ç½®
5. **å­˜å‚¨æ¶æ„** - æŠ½è±¡çš„StorageAdapteræ¨¡å¼

### âš ï¸ éœ€è¦ä¼˜åŒ–çš„é¢†åŸŸ

#### 1. **æ€§èƒ½ä¼˜åŒ–**
- [ ] è™šæ‹Ÿåˆ—è¡¨æ¸²æŸ“ï¼ˆTimelineé•¿åˆ—è¡¨ï¼‰
- [ ] å›¾ç‰‡æ‡’åŠ è½½å’Œå‹ç¼©
- [ ] Web Workerså¤„ç†é‡è®¡ç®—
- [ ] Service Workerç¦»çº¿æ”¯æŒ
- [ ] IndexedDBæŸ¥è¯¢ä¼˜åŒ–

#### 2. **ä»£ç æ¶æ„**
- [ ] çŠ¶æ€ç®¡ç†ç»Ÿä¸€åŒ–
- [ ] è‡ªå®šä¹‰HookæŠ½è±¡
- [ ] ç»„ä»¶æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†
- [ ] é”™è¯¯è¾¹ç•Œå¤„ç†
- [ ] TypeScriptç±»å‹å¢å¼º

#### 3. **ç”¨æˆ·ä½“éªŒ**
- [ ] éª¨æ¶å±ä¼˜åŒ–
- [ ] ä¹è§‚æ›´æ–°ç­–ç•¥
- [ ] ç¦»çº¿åŠŸèƒ½å®Œå–„
- [ ] PWA manifestå®Œå–„
- [ ] å“åº”å¼ä¼˜åŒ–

---

## ğŸ¯ ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ

### Phase 1: æ€§èƒ½ä¼˜åŒ–ï¼ˆç«‹å³å®æ–½ï¼‰

#### 1.1 è™šæ‹Ÿæ»šåŠ¨ï¼ˆTimelineç»„ä»¶ï¼‰
**é—®é¢˜**: æ¸²æŸ“å¤§é‡è®°å½•æ—¶æ€§èƒ½ä¸‹é™
**æ–¹æ¡ˆ**: ä½¿ç”¨@tanstack/react-virtual

```tsx
// å·²å®‰è£…ä¾èµ–ï¼Œéœ€è¦å®æ–½
import { useVirtualizer } from '@tanstack/react-virtual'
```

**å½±å“**: 
- å¤§æ•°æ®é›†ï¼ˆ1000+è®°å½•ï¼‰FPSæå‡60%+
- å†…å­˜å ç”¨å‡å°‘70%
- é¦–å±æ¸²æŸ“æ—¶é—´å‡å°‘40%

#### 1.2 å›¾ç‰‡ä¼˜åŒ–
**å½“å‰é—®é¢˜**:
- æœªä½¿ç”¨Next.js Imageç»„ä»¶
- ç¼ºå°‘å›¾ç‰‡å‹ç¼©
- æ— æ¸è¿›å¼åŠ è½½

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```typescript
// å®æ–½å›¾ç‰‡å‹ç¼©ç­–ç•¥
- JPEG: è´¨é‡80%ï¼Œæ¸è¿›å¼ç¼–ç 
- PNG: TinyPNGå‹ç¼©
- è§†é¢‘: é¦–å¸§æå–+ç¼©ç•¥å›¾
- ä½¿ç”¨Next/Imageè‡ªåŠ¨ä¼˜åŒ–
```

#### 1.3 Web Workers
**é€‚ç”¨åœºæ™¯**:
- éŸ³é¢‘æ ¼å¼è½¬æ¢
- å›¾ç‰‡å‹ç¼©å¤„ç†
- å¤§é‡æ•°æ®å¯¼å‡º

**æ”¶ç›Š**: ä¸»çº¿ç¨‹ä¸é˜»å¡ï¼Œç”¨æˆ·ä½“éªŒæµç•…

#### 1.4 IndexedDBä¼˜åŒ–
**å½“å‰é—®é¢˜**: ç¼ºå°‘ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```typescript
// æ·»åŠ å¤åˆç´¢å¼•
- [createdAt, id] - æ—¶é—´æ’åºæŸ¥è¯¢
- [hasAudio, createdAt] - ç­›é€‰æŸ¥è¯¢
- [hasImages, createdAt] - ç­›é€‰æŸ¥è¯¢
```

### Phase 2: æ¶æ„é‡æ„ï¼ˆæ¸è¿›å¼ï¼‰

#### 2.1 çŠ¶æ€ç®¡ç†ç»Ÿä¸€
**å½“å‰çŠ¶æ€**:
- Zustand: recordså­˜å‚¨
- React State: ç»„ä»¶çŠ¶æ€
- ç¼ºå°‘å…¨å±€é…ç½®ç®¡ç†

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```typescript
// åˆ›å»ºç»Ÿä¸€çš„storeç»“æ„
stores/
  â”œâ”€â”€ records-store.ts     âœ… å·²æœ‰
  â”œâ”€â”€ ui-store.ts          âš¡ æ–°å¢ - UIçŠ¶æ€
  â”œâ”€â”€ settings-store.ts    âš¡ æ–°å¢ - ç”¨æˆ·è®¾ç½®
  â””â”€â”€ cache-store.ts       âš¡ æ–°å¢ - ç¼“å­˜ç­–ç•¥
```

#### 2.2 è‡ªå®šä¹‰Hookæ ‡å‡†åŒ–
**å½“å‰é—®é¢˜**: HookèŒè´£ä¸å¤Ÿå•ä¸€

**é‡æ„å»ºè®®**:
```typescript
hooks/
  â”œâ”€â”€ data/              // æ•°æ®hooks
  â”‚   â”œâ”€â”€ use-records.ts
  â”‚   â”œâ”€â”€ use-location.ts
  â”‚   â””â”€â”€ use-storage-stats.ts
  â”œâ”€â”€ media/             // åª’ä½“hooks
  â”‚   â”œâ”€â”€ use-audio-recorder.ts
  â”‚   â”œâ”€â”€ use-image-upload.ts
  â”‚   â””â”€â”€ use-speech.ts
  â”œâ”€â”€ ui/                // UI hooks
  â”‚   â”œâ”€â”€ use-device-type.ts
  â”‚   â””â”€â”€ use-intersection-observer.ts
  â””â”€â”€ utils/             // å·¥å…·hooks
```

#### 2.3 ç»„ä»¶æ¨¡å—åŒ–
**å½“å‰ç»“æ„**: æ‰€æœ‰ç»„ä»¶å¹³é“º

**ä¼˜åŒ–ç»“æ„**:
```
components/
  â”œâ”€â”€ features/          // åŠŸèƒ½ç»„ä»¶
  â”‚   â”œâ”€â”€ record/
  â”‚   â”‚   â”œâ”€â”€ RecordInput/
  â”‚   â”‚   â”œâ”€â”€ Timeline/
  â”‚   â”‚   â””â”€â”€ TimelineItem/
  â”‚   â”œâ”€â”€ export/
  â”‚   â”‚   â”œâ”€â”€ ExportDialog/
  â”‚   â”‚   â””â”€â”€ EnglishPromptDialog/
  â”‚   â””â”€â”€ statistics/
  â”œâ”€â”€ shared/            // å…±äº«ç»„ä»¶
  â”‚   â”œâ”€â”€ AudioPlayer/
  â”‚   â”œâ”€â”€ ImageGrid/
  â”‚   â””â”€â”€ LazyImage/
  â””â”€â”€ ui/                // åŸºç¡€UI
      â””â”€â”€ shadcnç»„ä»¶
```

#### 2.4 é”™è¯¯è¾¹ç•Œ
**å½“å‰é—®é¢˜**: ç¼ºå°‘é”™è¯¯å¤„ç†

**å®æ–½æ–¹æ¡ˆ**:
```tsx
// åˆ›å»ºé”™è¯¯è¾¹ç•Œç»„ä»¶
components/ErrorBoundary.tsx
- æ•è·ç»„ä»¶é”™è¯¯
- ä¼˜é›…é™çº§
- é”™è¯¯ä¸ŠæŠ¥ï¼ˆå¯é€‰ï¼‰
```

### Phase 3: ç”¨æˆ·ä½“éªŒï¼ˆæŒç»­ä¼˜åŒ–ï¼‰

#### 3.1 éª¨æ¶å±å¢å¼º
**å½“å‰**: åŸºç¡€skeleton

**ä¼˜åŒ–**:
- ä¸å®é™…å†…å®¹åŒ¹é…çš„éª¨æ¶å±
- åŠ¨ç”»è¿‡æ¸¡æ›´è‡ªç„¶
- é¦–å±å…³é”®å†…å®¹ä¼˜å…ˆ

#### 3.2 ä¹è§‚æ›´æ–°
**é€‚ç”¨åœºæ™¯**:
- æ·»åŠ è®°å½• â†’ ç«‹å³æ˜¾ç¤ºï¼Œåå°ä¿å­˜
- åˆ é™¤è®°å½• â†’ ç«‹å³ç§»é™¤ï¼Œå¤±è´¥å›æ»š
- ç¼–è¾‘è®°å½• â†’ å³æ—¶æ›´æ–°UI

**æ”¶ç›Š**: ç”¨æˆ·æ„ŸçŸ¥é€Ÿåº¦æå‡80%+

#### 3.3 PWAå®Œå–„
**å½“å‰**: åŸºç¡€é…ç½®

**å¢å¼º**:
```json
// public/manifest.json
{
  "name": "Life Recorder",
  "short_name": "è®°å½•",
  "icons": [...],
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#0ea5e9",
  "categories": ["productivity", "lifestyle"]
}
```

#### 3.4 ç¦»çº¿åŠŸèƒ½
**å®æ–½**:
- Service Workerç¼“å­˜ç­–ç•¥
- ç¦»çº¿æ•°æ®åŒæ­¥é˜Ÿåˆ—
- ç½‘ç»œçŠ¶æ€æç¤º

### Phase 4: ä»£ç è´¨é‡ï¼ˆæŒç»­ï¼‰

#### 4.1 TypeScriptä¸¥æ ¼æ¨¡å¼
```json
// tsconfig.json
{
  "strict": true,
  "noImplicitAny": true,
  "strictNullChecks": true,
  "strictFunctionTypes": true
}
```

#### 4.2 å•å…ƒæµ‹è¯•
**å·¥å…·**: Jest + React Testing Library

**è¦†ç›–èŒƒå›´**:
- æ ¸å¿ƒHook: 80%+
- å·¥å…·å‡½æ•°: 90%+
- å…³é”®ç»„ä»¶: 70%+

#### 4.3 E2Eæµ‹è¯•
**å·¥å…·**: Playwright

**å…³é”®æµç¨‹**:
- æ·»åŠ è®°å½•æµç¨‹
- å¯¼å‡ºåŠŸèƒ½
- æ•°æ®æŒä¹…åŒ–

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡ï¼ˆåŸºäºWeb Vitalsï¼‰

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | ä¼˜åŒ–æ–¹æ¡ˆ |
|------|------|------|----------|
| FCP | ~1.2s | <0.8s | å…³é”®CSSå†…è”ã€å­—ä½“ä¼˜åŒ– |
| LCP | ~2.0s | <1.5s | å›¾ç‰‡ä¼˜åŒ–ã€é¢„åŠ è½½ |
| TTI | ~2.5s | <2.0s | ä»£ç åˆ†å‰²ã€å‡å°‘JS |
| CLS | <0.1 | <0.1 | éª¨æ¶å±ã€å°ºå¯¸é¢„ç•™ |
| FID | <100ms | <100ms | å·²ä¼˜åŒ– âœ… |

### åŒ…ä½“ç§¯ä¼˜åŒ–ç›®æ ‡

| ç±»å‹ | å½“å‰ | ç›®æ ‡ | æ–¹æ³• |
|------|------|------|------|
| é¦–å±JS | ~180KB | <120KB | åŠ¨æ€å¯¼å…¥ã€tree-shaking |
| é¦–å±CSS | ~25KB | <20KB | æŒ‰éœ€åŠ è½½ã€PurgeCSS |
| å›¾ç‰‡èµ„æº | å˜åŒ– | -30% | WebPã€å‹ç¼©ã€æ‡’åŠ è½½ |

---

## ğŸ› ï¸ å®æ–½ä¼˜å…ˆçº§

### ğŸ”¥ P0 - ç«‹å³æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰
1. âœ… è¯¾ç¨‹èŒƒå›´é€‰æ‹©åŠŸèƒ½
2. âš¡ è™šæ‹Ÿæ»šåŠ¨å®æ–½ï¼ˆTimelineï¼‰
3. âš¡ å›¾ç‰‡å‹ç¼©ä¼˜åŒ–
4. âš¡ é”™è¯¯è¾¹ç•Œæ·»åŠ 

### ğŸ“Œ P1 - çŸ­æœŸç›®æ ‡ï¼ˆ2å‘¨ï¼‰
1. IndexedDBç´¢å¼•ä¼˜åŒ–
2. Web WorkerséŸ³é¢‘å¤„ç†
3. ä¹è§‚æ›´æ–°ç­–ç•¥
4. éª¨æ¶å±ä¼˜åŒ–

### ğŸ“… P2 - ä¸­æœŸç›®æ ‡ï¼ˆ1æœˆï¼‰
1. ç»„ä»¶æ¨¡å—åŒ–é‡æ„
2. PWAå®Œå–„
3. ç¦»çº¿åŠŸèƒ½
4. å•å…ƒæµ‹è¯•è¦†ç›–

### ğŸ¯ P3 - é•¿æœŸç›®æ ‡ï¼ˆæŒç»­ï¼‰
1. E2Eæµ‹è¯•
2. æ€§èƒ½ç›‘æ§
3. ç”¨æˆ·åˆ†æ
4. æŒç»­ä¼˜åŒ–

---

## ğŸ” ç›‘æ§ä¸åº¦é‡

### æ€§èƒ½ç›‘æ§
```typescript
// ä½¿ç”¨Web Vitals API
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals'

// å‘é€åˆ°åˆ†æå¹³å°ï¼ˆå¯é€‰ï¼‰
```

### ç”¨æˆ·è¡Œä¸ºåˆ†æ
- åŠŸèƒ½ä½¿ç”¨é¢‘ç‡
- é”™è¯¯å‘ç”Ÿç‡
- å¹³å‡åœç•™æ—¶é—´

### èµ„æºç›‘æ§
- IndexedDBå®¹é‡
- å†…å­˜ä½¿ç”¨
- ç½‘ç»œè¯·æ±‚

---

## ğŸ“š å‚è€ƒèµ„æº

### æ€§èƒ½ä¼˜åŒ–
- [Next.js Performance](https://nextjs.org/docs/app/building-your-application/optimizing)
- [Web Vitals](https://web.dev/vitals/)
- [React Performance](https://react.dev/learn/render-and-commit)

### æ¶æ„è®¾è®¡
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [Feature-Sliced Design](https://feature-sliced.design/)
- [React Patterns](https://reactpatterns.com/)

### æœ€ä½³å®è·µ
- [Google Web Fundamentals](https://developers.google.com/web/fundamentals)
- [Airbnb React Style Guide](https://github.com/airbnb/javascript/tree/master/react)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/handbook/intro.html)

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-10-14
- âœ… è¯¾ç¨‹èŒƒå›´é€‰æ‹©åŠŸèƒ½å®æ–½
- âœ… è¾“å…¥æ³•é»‘æ¡†é—®é¢˜ä¿®å¤
- âœ… Tabèšç„¦åŠ¨ç”»ä¼˜åŒ–
- âœ… å¿«é€Ÿå¯¼å‡ºåŠŸèƒ½
- âœ… è‹±æ–‡Promptç”Ÿæˆå™¨
- ğŸ“ åˆ›å»ºå…¨é¢ä¼˜åŒ–æ–¹æ¡ˆæ–‡æ¡£

---

**ä¸‹ä¸€æ­¥**: å®æ–½P0ä¼˜å…ˆçº§çš„è™šæ‹Ÿæ»šåŠ¨å’Œå›¾ç‰‡ä¼˜åŒ–

