#!/bin/bash

# Cloudflare Pages éƒ¨ç½²è„šæœ¬
# ä½¿ç”¨æ–¹æ³•: ./scripts/deploy.sh

set -e

echo "ğŸš€ å¼€å§‹éƒ¨ç½²åˆ° Cloudflare Pages..."

# æ£€æŸ¥æ˜¯å¦å®‰è£…äº† wrangler
if ! command -v wrangler &> /dev/null; then
    echo "âŒ Wrangler CLI æœªå®‰è£…ï¼Œæ­£åœ¨å®‰è£…..."
    npm install -g wrangler
fi

# æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
if ! wrangler whoami &> /dev/null; then
    echo "âŒ è¯·å…ˆç™»å½• Cloudflare:"
    echo "è¿è¡Œ: wrangler login"
    exit 1
fi

# æ„å»ºé¡¹ç›®
echo "ğŸ“¦ æ„å»ºé¡¹ç›®..."
npm run build

# æ£€æŸ¥æ„å»ºè¾“å‡º
if [ ! -d "out" ]; then
    echo "âŒ æ„å»ºå¤±è´¥ï¼Œæœªæ‰¾åˆ°è¾“å‡ºç›®å½• 'out'"
    exit 1
fi

echo "âœ… æ„å»ºæˆåŠŸï¼"

# éƒ¨ç½²åˆ° Cloudflare Pages
echo "ğŸŒ éƒ¨ç½²åˆ° Cloudflare Pages..."
wrangler pages deploy out --project-name=life-recorder

echo "ğŸ‰ éƒ¨ç½²å®Œæˆï¼"
echo "è®¿é—®ä½ çš„åº”ç”¨: https://life-recorder.pages.dev"
