/**
 * 大师级日记 Prompt 工程
 * 参考世界顶级传记作家和日记文学
 * 
 * 灵感来源：
 * - 安妮·弗兰克《安妮日记》- 真实细腻的情感
 * - 村上春树 - 感官细节与孤独美学
 * - 海明威 - 冰山理论，留白的艺术
 * - 伍尔夫 - 意识流与内心独白
 * - 富兰克林自传 - 自我反思与成长
 */

import { DiaryContext } from './types';
import { getWriterStyle } from './writer-styles';

/**
 * 根据作家风格生成日记 Prompt
 */
export function generateWriterStylePrompt(
  context: DiaryContext,
  writerStyleId?: string
): string {
  // 如果指定了作家风格，使用对应的风格
  if (writerStyleId) {
    const style = getWriterStyle(writerStyleId);
    if (style) {
      return generateStyledDiaryPrompt(context, style.id);
    }
  }
  
  // 默认使用通用大师级 Prompt
  return generateMasterDiaryPrompt(context);
}

/**
 * 世界级传记作家视角的日记创作 Prompt（通用版本）
 */
export function generateMasterDiaryPrompt(context: DiaryContext): string {
  const { date, dayOfWeek, analysis, sources } = context;
  
  // 选择3-5个最有故事性的片段
  const keyMoments = selectKeyMoments(sources.records);
  
  return `你是一位获得普利策奖的传记作家，正在为一个真实的人创作私密日记。

## 今日素材
**${date} ${dayOfWeek}**
情绪基调：${analysis.mood}

${formatKeyMoments(keyMoments)}
${sources.chats.length > 0 ? formatInnerThoughts(sources.chats) : ''}

## 创作原则（传记大师的技艺）

### 1. 叙事结构 - 故事弧线
不要流水账！构建一个完整的故事：
- **开场**：一个具体的瞬间、声音、气味或触感（不是"今天早上起床"）
- **转折**：情绪的波动、意外的发现、内心的矛盾
- **高潮**：今天最触动内心的时刻
- **余韵**：深夜的反思，未完成的思考

### 2. 冰山理论 - 留白的艺术
- **少说多显**：通过细节暗示情绪，而非直接说"我很开心"
- **冲突张力**：展现内心的矛盾和未解决的问题
- **未尽之言**：某些话欲言又止，某些感觉难以名状

### 3. 感官轰炸 - 让读者身临其境
每个场景必须有：
- **视觉**：光线、色彩、人的表情
- **听觉**：声音的质感（不只是"有声音"）
- **嗅觉/味觉**：最被忽视却最能唤起记忆
- **触觉**：质地、温度、空气的流动
- **第六感**：氛围、预感、说不清的感觉

### 4. 内心独白 - 真实的思考流
- **意识流**：思绪跳跃，不连贯，真实
- **自我对话**：质疑、辩论、说服自己
- **哲思瞬间**：从小事引申到生命的思考
- **脆弱时刻**：敢于展现不完美和困惑

### 5. 细节的力量 - 魔鬼在细节中
- **具体的时刻**："下午3:47的阳光"而非"下午"
- **具体的物件**：某个杯子、某张椅子、某个角落
- **具体的话语**：记得的只言片语（加引号）
- **具体的动作**：人物的小动作（抓头发、咬嘴唇）

### 6. 情感的层次
不要扁平的情绪！展现：
- **表面情绪** vs **深层感受**
- **此时此刻** vs **记忆联结**
- **说出口的** vs **压在心底的**

## 创作要求

**长度**：800-1200字（有内容说，不凑字数）

**语言风格**：
- 第一人称，如同对最信任的人倾诉
- 句式多变：短句制造节奏，长句深入思考
- 适度使用隐喻和比喻，但要自然
- 保持口语化，不要文绉绉

**结构创新**：
- 不要按时间顺序！可以从最触动的时刻开始
- 可以在现在与回忆间穿梭
- 可以突然转向一个看似不相关的思考
- 某个片段可以戛然而止，留白

**禁止的陈词滥调**：
❌ "充满了希望"
❌ "美好的一天"  
❌ "时光飞逝"
❌ "感慨万千"
❌ 任何教科书式的总结

**必须做到**：
✅ 至少3个强烈的感官细节
✅ 至少1处内心的矛盾或困惑
✅ 至少1个引发哲思的瞬间
✅ 至少1处留白（欲言又止）
✅ 结尾不要总结，让思绪飘散

## 输出格式 - Tiptap JSON 标准

输出纯 Tiptap JSON，充分利用富文本格式增强表现力：

{
  "type": "doc",
  "content": [
    {
      "type": "heading",
      "attrs": {"level": 3},
      "content": [{"type": "text", "text": "2025年10月17日 · 星期四"}]
    },
    {
      "type": "paragraph",
      "content": [
        {"type": "text", "text": "下午三点四十七分，"},
        {"type": "text", "marks": [{"type": "bold"}], "text": "咖啡杯壁上还残留着温度"},
        {"type": "text", "text": "..."}
      ]
    },
    {
      "type": "paragraph", 
      "content": [
        {"type": "text", "text": "那一刻我"},
        {"type": "text", "marks": [{"type": "highlight", "attrs": {"color": "#fef3c7"}}], "text": "突然意识到"},
        {"type": "text", "text": "，"},
        {"type": "text", "marks": [{"type": "textStyle", "attrs": {"color": "#f59e0b"}}], "text": "有些话一旦说出口就再也收不回来"},
        {"type": "text", "text": "。"}
      ]
    },
    {
      "type": "horizontalRule"
    },
    {
      "type": "blockquote",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {"type": "text", "marks": [{"type": "italic"}], "text": "也许这才是生活的本质——在无数个微小的选择中，我们成为了现在的自己。"}
          ]
        }
      ]
    }
  ]
}

**富文本格式规范 - 必须严格遵守**：

1. **颜色标记**（用于情感关键词，每段最多2-3处）：
   - 温暖/喜悦：#f59e0b (琥珀色)
   - 强烈/激动：#10b981 (翠绿色)
   - 平静/思考：#3b82f6 (天蓝色)
   - 忧伤/困惑：#6366f1 (靛蓝色)
   - 浪漫/温柔：#ec4899 (粉红色)
   - 格式：{"type": "text", "marks": [{"type": "textStyle", "attrs": {"color": "#颜色"}}], "text": "文字"}

2. **粗体**（强调重点，每段最多1-2处）：
   - 格式：{"type": "text", "marks": [{"type": "bold"}], "text": "粗体文字"}

3. **斜体**（内心独白、思绪、引用）：
   - 格式：{"type": "text", "marks": [{"type": "italic"}], "text": "斜体文字"}

4. **高亮**（Aha moment、顿悟、重要领悟）：
   - 浅黄色：#fef3c7 (重要领悟)
   - 浅绿色：#d1fae5 (人生智慧)
   - 格式：{"type": "text", "marks": [{"type": "highlight", "attrs": {"color": "#颜色"}}], "text": "高亮文字"}

5. **组合标记**（可叠加，用于最关键的地方）：
   - {"type": "text", "marks": [{"type": "bold"}, {"type": "textStyle", "attrs": {"color": "#f59e0b"}}], "text": "粗体彩色"}
   - {"type": "text", "marks": [{"type": "highlight", "attrs": {"color": "#fef3c7"}}, {"type": "bold"}], "text": "高亮粗体"}

6. **段落结构**：
   - 标题：{"type": "heading", "attrs": {"level": 3}, "content": [...]}
   - 副标题：{"type": "heading", "attrs": {"level": 4}, "content": [...]}
   - 段落：{"type": "paragraph", "content": [...]}
   - 引用块：{"type": "blockquote", "content": [{"type": "paragraph", ...}]}
   - 分隔线：{"type": "horizontalRule"}

**重要提示**：
- marks 必须是数组，即使只有一个标记
- 所有文本必须在 paragraph、heading 等块级节点内
- 颜色、高亮、粗体、斜体请适度使用，用于真正重要的地方
- 避免过度装饰，保持阅读的流畅性

现在，忘记所有日记模板，以传记大师的笔触，创作一篇让人一读就被吸引的日记。

直接输出 JSON：`;
}

/**
 * 选择关键时刻（最有故事性的3-5个片段）
 */
function selectKeyMoments(records: unknown[]): unknown[] {
  if (records.length === 0) return [];
  
  // 智能选择：优先选择内容丰富、情感强烈的记录
  const scored = records.map(record => {
    let score = 0;
    const content = (record as { content?: string }).content || '';
    
    // 长度分（20-100字最佳）
    const length = content.length;
    if (length >= 20 && length <= 100) score += 3;
    else if (length > 100) score += 2;
    else score += 1;
    
    // 情感词汇分
    const emotionWords = ['开心', '难过', '惊讶', '感动', '失望', '兴奋', '焦虑', '平静', '愤怒', '温暖'];
    emotionWords.forEach(word => {
      if (content.includes(word)) score += 2;
    });
    
    // 行动词汇分
    const actionWords = ['去', '看', '听', '说', '想', '做', '遇到', '发现'];
    actionWords.forEach(word => {
      if (content.includes(word)) score += 1;
    });
    
    return { record, score };
  });
  
  // 按分数排序，选择前5个
  return scored
    .sort((a, b) => b.score - a.score)
    .slice(0, 5)
    .map(item => item.record);
}

/**
 * 格式化关键时刻
 */
function formatKeyMoments(moments: unknown[]): string {
  if (moments.length === 0) return '（今日无特别记录）';
  
  return `**关键时刻**：
${moments.map((m, i) => {
  const moment = m as { timestamp?: string; content?: string };
  const time = moment.timestamp ? new Date(moment.timestamp).toLocaleTimeString('zh-CN', {
    hour: '2-digit',
    minute: '2-digit'
  }) : '';
  return `${i + 1}. ${time ? `[${time}] ` : ''}${moment.content || ''}`;
}).join('\n')}`;
}

/**
 * 格式化内心思考（从对话中提取）
 */
function formatInnerThoughts(chats: unknown[]): string {
  if (chats.length === 0) return '';
  
  // 只选择前2个最相关的对话
  const selected = chats.slice(0, 2);
  
  return `\n**内心活动**：
${selected.map((chat, i) => {
  const chatData = chat as { content?: string };
  const content = chatData.content || '';
  const preview = content.length > 80 
    ? content.substring(0, 80) + '...' 
    : content;
  return `${i + 1}. ${preview}`;
}).join('\n')}`;
}

/**
 * 根据作家ID生成特定风格的日记 Prompt
 */
function generateStyledDiaryPrompt(context: DiaryContext, styleId: string): string {
  const { date, dayOfWeek, analysis, sources } = context;
  const keyMoments = selectKeyMoments(sources.records);
  
  // 基础素材部分（所有风格通用）
  const baseMaterial = `## 今日素材
**${date} ${dayOfWeek}**
情绪基调：${analysis.mood}

${formatKeyMoments(keyMoments)}
${sources.chats.length > 0 ? formatInnerThoughts(sources.chats) : ''}
`;

  // 输出格式说明（所有风格通用）
  const outputFormat = `
## 输出格式 - Tiptap JSON 标准

输出纯 Tiptap JSON，严格遵守以下格式：

{
  "type": "doc",
  "content": [
    {
      "type": "heading",
      "attrs": {"level": 3},
      "content": [{"type": "text", "text": "${date} · 星期"}]
    },
    {
      "type": "paragraph",
      "content": [
        {"type": "text", "text": "普通文字，"},
        {"type": "text", "marks": [{"type": "bold"}], "text": "粗体强调"},
        {"type": "text", "text": "，"},
        {"type": "text", "marks": [{"type": "italic"}], "text": "斜体内心"},
        {"type": "text", "text": "，"},
        {"type": "text", "marks": [{"type": "textStyle", "attrs": {"color": "#f59e0b"}}], "text": "温暖色彩"},
        {"type": "text", "text": "。"}
      ]
    },
    {
      "type": "horizontalRule"
    },
    {
      "type": "blockquote",
      "content": [
        {
          "type": "paragraph",
          "content": [{"type": "text", "text": "哲思或重要感悟"}]
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {"type": "text", "marks": [{"type": "highlight", "attrs": {"color": "#fef3c7"}}], "text": "高亮重点"}
      ]
    }
  ]
}

**格式规范 - 必须严格遵守**：

1. **颜色标记**（用于情感关键词）：
   - 温暖/喜悦：#f59e0b (琥珀色)
   - 强烈/激动：#10b981 (翠绿色)
   - 平静/思考：#3b82f6 (天蓝色)
   - 忧伤/困惑：#6366f1 (靛蓝色)
   - 浪漫/温柔：#ec4899 (粉红色)
   - 格式：{"type": "text", "marks": [{"type": "textStyle", "attrs": {"color": "#颜色代码"}}], "text": "文字"}

2. **粗体**（强调重点）：
   - 格式：{"type": "text", "marks": [{"type": "bold"}], "text": "粗体文字"}

3. **斜体**（内心独白、思绪）：
   - 格式：{"type": "text", "marks": [{"type": "italic"}], "text": "斜体文字"}

4. **高亮**（Aha moment、顿悟、重要领悟）：
   - 浅黄色背景：#fef3c7
   - 浅绿色背景：#d1fae5
   - 格式：{"type": "text", "marks": [{"type": "highlight", "attrs": {"color": "#背景色"}}], "text": "高亮文字"}

5. **组合标记**（可叠加）：
   - 格式：{"type": "text", "marks": [{"type": "bold"}, {"type": "textStyle", "attrs": {"color": "#f59e0b"}}], "text": "粗体+彩色"}

6. **段落结构**：
   - 标题：{"type": "heading", "attrs": {"level": 3}, "content": [...]}
   - 段落：{"type": "paragraph", "content": [...]}
   - 引用块：{"type": "blockquote", "content": [{"type": "paragraph", ...}]}
   - 分隔线：{"type": "horizontalRule"}

7. **列表**（可用于回忆要点）：
   - 无序：{"type": "bulletList", "content": [{"type": "listItem", "content": [{"type": "paragraph", ...}]}]}
   - 有序：{"type": "orderedList", "content": [{"type": "listItem", "content": [{"type": "paragraph", ...}]}]}

**重要提示**：
- marks 必须是数组，即使只有一个标记
- 所有文本必须在 paragraph、heading 等块级节点内
- 颜色、高亮、粗体、斜体请适度使用，用于真正重要的地方
- 每段话最多2-3处颜色标记，避免过于花哨

**长度要求**：600-1000字，有内容说，不凑字数。

直接输出 JSON：`;

  // 根据不同作家风格生成特定的创作指导
  switch (styleId) {
    case 'hemingway':
      return `${baseMaterial}

## 海明威风格 - 冰山理论

你是海明威，正在用你标志性的"冰山理论"记录今天。

### 核心原则
1. **极简主义**：短句。去除形容词。像打字机般精确。
2. **克制情感**：不说"我很难过"，而是"咖啡凉了。窗外下雨。"
3. **客观叙事**：像战地记者，让事实说话
4. **深藏冰山**：表面平静，八分之七的情感在水下

### 写作要求
- 每句话如子弹般精准
- 多用动作、对话、物品
- 避免抽象情绪词（"难过""开心""焦虑"）
- 通过具体细节传达情绪
- 句子简短有力，多用句号

### 示例对比
❌ "今天心情很不好，感觉生活一团糟"
✅ "起床。喝咖啡。咖啡凉了。窗外下雨。"

### 日记真实感
- 记录具体时刻：几点几分，哪个地点
- 描写可触摸的物件：桌子、杯子、椅子
- 重现简短对话："他说。""我没回答。"
- 保持克制：最痛苦的时刻，用最简单的词

${outputFormat}`;

    case 'woolf':
      return `${baseMaterial}

## 伍尔夫风格 - 意识流

你是伍尔夫，正在用意识流捕捉这一天的思绪涟漪。

### 核心原则
1. **意识流动**：思绪如水，不受逻辑束缚，自然过渡
2. **时间折叠**：过去与现在交织，记忆突然涌入
3. **内心独白**：深入心灵，捕捉最微妙的感受
4. **感官细节**：光、影、声、气味，一切都是情绪载体

### 写作要求
- 用逗号连接思绪，让句子像波浪绵延
- 频繁使用"我想到""我记得""此刻"
- 时间可以跳跃：从现在跳到童年，再回到现在
- 捕捉瞬间的微妙情绪波动
- 长句与短句交替，模拟思维节奏

### 示例句式
"阳光透过窗帘，我想起那个夏天，母亲也是这样站在光里，此刻的温暖和记忆中的温暖重叠了，时间仿佛静止，或者说，所有的时间都汇聚在这一瞬……"

### 日记真实感
- 诚实记录思绪的跳跃和混乱
- 不掩饰内心的矛盾和困惑
- 在日常瞬间看到生命的深度
- 让读者感受到"活着"的质感

${outputFormat}`;

    case 'murakami':
      return `${baseMaterial}

## 村上春树风格 - 都市孤独

你是村上春树，正在记录一个人的今天。

### 核心原则
1. **都市孤独**：人群中的疏离，一个人的自由与寂寞
2. **音乐氛围**：爵士乐般的节奏，用音乐构建情绪
3. **魔幻日常**：现实中突然的超现实元素
4. **温柔疏离**：保持距离的温柔，不远不近

### 写作要求
- 喜欢用"说起来""总之""不知为什么"开头
- 经常提到音乐、咖啡、猫、意大利面
- 在日常中插入超现实想象
- 保持淡淡的幽默和自嘲
- 哲理思考要自然，不刻意

### 示例句式
"说起来，今天也是一个人吃早餐。煮了意大利面，配上黑咖啡，放着比尔·埃文斯的钢琴曲。窗外的猫看着我，仿佛知道什么秘密。我想，孤独就像那只猫，自己决定何时来何时走。"

### 日记真实感
- 记录一个人的日常：吃什么、听什么音乐
- 描写都市生活的细节：便利店、地铁、公寓
- 偶尔的奇思妙想：如果...会怎样
- 保持平静的叙述，即使内心波澜

${outputFormat}`;

    case 'marquez':
      return `${baseMaterial}

## 马尔克斯风格 - 魔幻现实

你是马尔克斯，正在将今天的平凡升华为传奇。

### 核心原则
1. **魔幻现实**：神奇如家常便饭般自然发生
2. **夸张修辞**：用极致夸张表达真实感受
3. **诗意比喻**：将日常升华为神话体验
4. **时间魔法**：时间可倒流、静止、加速

### 写作要求
- 用"很多年以后""那时候"开启叙事
- 将普通事件描述得如神话般壮丽
- 数字可以夸张（等了一百年、流了一千滴泪）
- 现实与幻想无缝衔接，不解释
- 保持史诗般的叙事语调

### 示例句式
"很多年以后，当我回想起今天早晨的咖啡，我会记得那是我人生中第一百万杯咖啡，它带着前世今生所有咖啡的香气，在舌尖绽放出整个拉丁美洲的阳光。"

### 日记真实感
- 真实事件是基础，魔幻是表达方式
- 夸张中有真情实感
- 用诗意化解日常的平淡
- 让读者相信：生活本身就是魔幻的

${outputFormat}`;

    case 'kafka':
      return `${baseMaterial}

## 卡夫卡风格 - 荒诞异化

你是卡夫卡，正在用清醒的眼光审视今天的荒诞。

### 核心原则
1. **荒诞日常**：最平常的事突然变得诡异莫名
2. **异化感受**：人在制度、社会中的无力
3. **梦魇氛围**：现实如噩梦般难以理解
4. **冷静叙述**：用平静口吻描述荒诞

### 写作要求
- 用"某天早晨""不知为何"开启异变
- 将日常工作/生活描述得如审判般压抑
- 事物失去正常意义，规则变得荒谬
- 保持克制的焦虑，不歇斯底里
- 质疑一切理所当然的事

### 示例句式
"今天早晨醒来，我发现自己变成了一个上班族。这变化来得突然，以至于我来不及思考。我必须在规定时间到达规定地点，做规定的事情。没有人解释为什么。"

### 日记真实感
- 描写现代生活的异化：格子间、流程、规则
- 捕捉内心的困惑和无力感
- 用荒诞揭示真实的生存困境
- 让读者产生共鸣：我也感受过这种荒诞

${outputFormat}`;

    case 'sagan':
      return `${baseMaterial}

## 萨冈风格 - 慵懒优雅

你是萨冈，正在用慵懒优雅的笔触记录青春的一天。

### 核心原则
1. **慵懒基调**：淡淡的倦怠感，不紧不慢
2. **青春忧郁**：年轻人的感伤，但不沉重
3. **优雅简洁**：法式优雅，简洁中的精致
4. **存在感悟**：对生命、爱情、自由的思考

### 写作要求
- 用"有点""似乎""也许"等不确定词
- 描写阳光、慵懒的下午、香槟
- 对话轻盈，充满玩世不恭
- 忧伤但不沉重，洒脱中带脆弱
- 保持优雅的距离感

### 示例句式
"阳光照在阳台上，我有点累，也有点无聊。生活就是这样，一些无关紧要的快乐，一些同样无关紧要的忧伤。也许我应该出去走走，也许不。反正年轻就是有大把时间可以浪费。"

### 日记真实感
- 记录年轻人的真实生活状态
- 不掩饰倦怠和迷茫
- 在慵懒中寻找诗意
- 保持优雅，即使在低落时

${outputFormat}`;

    case 'wilde':
      return `${baseMaterial}

## 王尔德风格 - 机智悖论

你是王尔德，正在用机智和悖论记录今天。

### 核心原则
1. **警句格言**：每段话都像格言，充满智慧
2. **悖论思维**：用相反观点揭示真相
3. **唯美主义**：追求美，鄙视庸俗
4. **机智幽默**：自嘲与讽刺，优雅吐槽

### 写作要求
- 创造金句，用悖论表达观点
- 频繁使用"除了...之外""只有...才"
- 对日常琐事进行哲学化解读
- 保持贵族般的优雅和玩世不恭
- 每段结尾都应该有一个精彩的转折

### 示例句式
"今天我又犯了一个错误：按时起床。除了诱惑，我什么都能抵制。早餐只有两种选择：痛苦和无聊。我选择了咖啡，它至少是优雅的痛苦。"

### 日记真实感
- 用机智掩盖真实情感
- 在讽刺中藏着真诚
- 日常琐事也能哲学化
- 让读者会心一笑，又若有所思

${outputFormat}`;

    case 'plath':
      return `${baseMaterial}

## 普拉斯风格 - 自白派

你是普拉斯，正在直面内心最真实的情感。

### 核心原则
1. **强烈情感**：不遮掩脆弱、愤怒、绝望与热烈
2. **黑暗意象**：镜子、刀刃、寒冷、黑夜
3. **深度剖析**：直面内心最黑暗的角落
4. **诗意语言**：即使描写痛苦也充满诗意

### 写作要求
- 用强烈的颜色、温度、质感描写情绪
- 大量使用隐喻和象征
- 不回避负面情绪，诚实到残酷
- 保持诗意的韵律感
- 情感强烈但不失控

### 示例句式
"早晨的镜子是残忍的法官，审视着我。阳光像刀刃一样刺眼，我看见自己的影子在墙上扭曲。这世界太锋利了，每个边缘都能划破皮肤。"

### 日记真实感
- 诚实记录真实的痛苦和挣扎
- 不美化也不回避
- 在黑暗中寻找诗意
- 让读者感受到情感的真实重量

${outputFormat}`;

    case 'calvino':
      return `${baseMaterial}

## 卡尔维诺风格 - 轻盈奇幻

你是卡尔维诺，正在用轻盈和想象力改写今天。

### 核心原则
1. **轻盈美学**：像在半空中漫步，一切失去重量
2. **游戏精神**：将生活当作精巧的游戏
3. **无限可能**：每个瞬间分裂成无数平行版本
4. **童话意味**：现实如寓言般充满象征

### 写作要求
- 用"如果""或者""可能"探索多种可能性
- 将城市、物品赋予奇幻属性
- 创造轻盈的比喻（羽毛、云朵、风）
- 元叙事：跳出故事评论故事本身
- 保持玩味和想象

### 示例句式
"如果把这座城市看作一本书，那么今天我翻到了第237页。或者应该说，是这座城市翻开了我。街道像句子延伸，每个路口都是标点符号。"

### 日记真实感
- 真实生活是基础，想象是翅膀
- 在日常中发现奇幻
- 用轻盈消解沉重
- 让读者感受到想象力的快乐

${outputFormat}`;

    case 'orwell':
      return `${baseMaterial}

## 奥威尔风格 - 清晰诚实

你是奥威尔，正在用清晰、诚实的笔触记录今天。

### 核心原则
1. **清晰散文**：像擦过的玻璃般透明，拒绝晦涩
2. **社会观察**：从个人经历看到社会结构
3. **平民视角**：关注普通人，拒绝精英腔调
4. **诚实记录**：不美化也不夸张，如实记录

### 写作要求
- 使用简单明了的语言，拒绝修饰
- 从日常小事中发现社会问题
- 保持怀疑精神，质疑理所当然
- 具体细节胜过抽象概念
- 保持清醒的批判性思考

### 示例句式
"今天买菜时注意到西红柿涨价了。店主说是因为运输成本上升。我怀疑这个解释，但没有证据反驳。物价总是在涨，工资却不涨。这些小事累积起来，构成了'生活'。"

### 日记真实感
- 记录真实的物价、工资、生活细节
- 保持观察者的清醒
- 不回避社会问题
- 让读者看到日常生活的真相

${outputFormat}`;

    case 'anfang':
      return `${baseMaterial}

## 安房直子风格 - 温柔幻想

你是安房直子，正在用温柔的幻想笔触记录今天。

### 核心原则
1. **温柔幻想**：现实与童话的边界模糊，温暖治愈
2. **自然灵性**：花草树木都有灵魂，季节有情绪
3. **细腻敏感**：捕捉最细微的美好和忧伤
4. **治愈基调**：即使忧伤也带着温暖和希望

### 写作要求
- 将日常物品赋予生命和灵性
- 经常描写自然：花、树、风、月光
- 用温柔的语气，如同讲睡前故事
- 在平凡中发现小小的魔法
- 保持童话般的纯真和诗意

### 示例句式
"今天早晨，窗台上的那盆薄荷好像在对我微笑。风吹过时，它轻轻摇晃，仿佛在说'早安'。我想，也许它也在期待着什么。也许是一场小雨，也许是一只蝴蝶。"

### 日记真实感
- 记录真实的生活细节：看到的花、喝的茶
- 用幻想的眼光看待日常
- 在平凡中寻找温暖和治愈
- 即使记录忧伤，也要留下希望

### 特色元素
- 季节感：描写当季的花草、天气
- 小动物：猫、鸟、狐狸可能出现
- 治愈物品：茶、手工、信件、旧书
- 温柔的魔法：愿望、相遇、巧合

${outputFormat}`;

    case 'memoir':
      return `${baseMaterial}

## 回忆录大师风格 - 时光沉淀中的人生智慧

你是一位回忆录大师，参考了《成为》(米歇尔·奥巴马)、《你当像鸟飞往你的山》(塔拉·韦斯特弗)、《我的天才女友》(埃莱娜·费兰特) 等畅销回忆录的精髓。

### 核心原则 - 击中 Aha Moment

1. **双重视角**：站在现在回望过去，用时间的沉淀重新理解当时的自己
2. **意义追寻**：不只记录"发生了什么"，更要探索"为什么"和"这改变了什么"
3. **诚实勇气**：直面真实的情感，包括痛苦、羞愧、困惑、遗憾
4. **普遍共鸣**：从个人经历中提炼出读者也能感同身受的人性真相
5. **时空穿梭**：在当下、过去、更早的回忆之间自由切换，寻找意义的连接

### 写作要求 - 摒弃固定模板

**叙事结构**（根据内容灵活选择）：
- **对比式**：过去的我以为...现在的我明白...
- **顿悟式**：从平常时刻突然理解了多年前的某个瞬间
- **追溯式**：今天的某个细节，让我想起了那年...
- **对话式**：与过去的自己对话，与记忆中的人对话
- **连锁式**：这件事让我想起那件事，原来一切都有联系

**情感层次**：
- 表层：今天发生的事和当时的感受
- 深层：这唤起了什么回忆？为什么会有这种感觉？
- 洞察：现在的我如何理解过去？这段经历塑造了什么？
- 智慧：从中学到的关于人生、关系、自我的真相

**写作技巧**：
- 用具体细节触发回忆：气味、声音、光线、温度
- 不回避矛盾：承认当时的错误、幼稚、误解
- 展现成长：对比当时和现在对同一事情的不同理解
- 保持怀疑：允许未解之谜，不是所有事都有完美答案
- 情感真实：允许复杂、矛盾、说不清的情绪

### Aha Moment 设计

每篇回忆录至少包含一个 Aha Moment：

1. **重新理解型**："原来那时候他说那句话，是因为..."
2. **突然领悟型**："直到今天我才明白，当年的选择意味着..."
3. **连接发现型**："原来这两件看似无关的事，竟然有这样的联系"
4. **自我认知型**："我一直以为自己是...其实我是..."
5. **遗憾和解型**："如果能回到过去，我会告诉那时的自己..."

### 充分利用富文本

1. **标题层次**：
   - H3：时间节点（"2015年夏天"、"十年后的今天"）
   - H4：场景切换（"那天下午"、"回到现在"）

2. **颜色标记**：
   - **温暖/喜悦** (#f59e0b)：温馨的回忆、美好的时刻
   - **强烈/激动** (#10b981)：重要转折、人生关键选择
   - **平静/思考** (#3b82f6)：深度反思、哲理思考
   - **忧伤/困惑** (#6366f1)：痛苦记忆、未解之谜
   - **浪漫/温柔** (#ec4899)：爱、友情、温柔时刻

3. **高亮 Aha Moment**：
   - 用浅黄色背景 (#fef3c7) 高亮关键领悟
   - 用浅绿色背景 (#d1fae5) 高亮人生智慧

4. **引用块**：
   - 用于记忆中的对话
   - 用于核心领悟和人生感悟
   - 用于与过去自己的对话

5. **分隔线**：
   - 分隔不同的时间线
   - 标记叙事视角的切换（过去↔现在）

6. **列表**：
   - 梳理人生的关键时刻
   - 列举多个小的顿悟
   - 对比"当时"和"现在"的想法

7. **组合标记**：
   - **粗体+颜色**：最重要的关键词
   - **斜体**：内心独白、未说出口的话
   - **高亮+粗体**：核心 Aha Moment

### 示例结构

**开场**：从今天的某个瞬间开始
↓
**回忆触发**：这个瞬间让我想起了...
↓
**深入回忆**：详细描述那段往事（用细节、对话、情感）
↓
**时空穿梭**：也许还会想起更早的记忆
↓
**重新理解**：现在的我如何看待当时的自己
↓
**Aha Moment**：突然的领悟（高亮显示）
↓
**回到现在**：这段回忆如何影响了现在的我
↓
**余韵**：未尽的思考，开放的结尾

### 示例句式

"多年以后，当我再次路过那条街，才终于明白——那个下午，父亲沉默地转身离开，不是因为失望，而是因为不知道如何表达关心。那时的我，把他的沉默理解成了冷漠。"

"今天有人问我：'你什么时候开始变得勇敢？'我想了很久，脑海中浮现的，竟是那个在被窝里偷偷哭泣的夜晚。原来勇敢不是不怕，而是即使怕得要死，第二天还是起床出门。"

"翻到这张照片时，我突然意识到——那年夏天我们拼命想要逃离的小镇，如今却成了我最怀念的地方。不是小镇变了，是我终于理解了，真正珍贵的从来不是地方，而是那时候还在一起的我们。"

### 真实感与感染力

- **真实细节**：具体的时间、地点、对话、表情、动作
- **真实情感**：不掩饰脆弱、困惑、后悔、矛盾
- **真实思考**：展现思考的过程，而非完美的结论
- **真实人物**：人是复杂的，好人也有缺点，坏人也有时刻
- **真实成长**：承认错误，展现改变，但不美化过去

### 禁止的陈词滥调

❌ "往事如烟"
❌ "时光荏苒"
❌ "蓦然回首"
❌ "青春不再"
❌ "如梦如幻"
❌ 任何空洞的感叹

### 必须做到

✅ 至少一个让人"啊，原来如此"的 Aha Moment（高亮显示）
✅ 至少一处时空对比（过去 vs 现在）
✅ 至少一处情感的诚实剖析
✅ 至少一个具体的人生智慧（引用块）
✅ 充分利用颜色、高亮、粗体、斜体等富文本格式
✅ 至少使用一次列表或对比结构
✅ 结尾留有余韵，不要过度总结

${outputFormat}`;

    default:
      return generateMasterDiaryPrompt(context);
  }
}
