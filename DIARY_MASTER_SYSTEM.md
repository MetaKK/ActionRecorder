# 🏆 大师级日记系统 - 设计文档

## 📖 设计理念

从**流水账时间线** → **世界级传记作家笔触**

### 参考的文学大师

| 大师 | 核心技艺 | 应用到日记 |
|------|---------|-----------|
| **安妮·弗兰克** | 真实细腻的情感流动 | 不掩饰脆弱，展现真实的内心波动 |
| **村上春树** | 感官细节 + 孤独美学 | 每个场景都有触感、气味、光线 |
| **海明威** | 冰山理论，留白的艺术 | 说一半留一半，让读者自己体会 |
| **伍尔夫** | 意识流与内心独白 | 思绪跳跃，真实的思考流 |
| **富兰克林** | 自我反思与成长 | 从小事引申到生命的思考 |

---

## 🎯 核心改进

### ❌ 旧版本（时间线流水账）

```
⏰ 早晨·7:30
清晨的阳光透过窗帘洒进来，温暖而柔和。

⏰ 上午·10:00  
开始工作，完成了几个任务。

⏰ 下午·3:00
喝了一杯咖啡，感觉不错。

💭 今日反思
今天是充实的一天，继续努力。
```

**问题：**
- ❌ 没有故事弧线，只是罗列事件
- ❌ 情感扁平，"温暖"、"不错"等词语没有感染力
- ❌ 缺少细节，读者无法身临其境
- ❌ 没有内心冲突和思考深度
- ❌ 结尾总结性太强，像作文

### ✅ 新版本（传记作家笔触）

```
2025年10月17日·下午三点四十七分

咖啡杯壁上还残留着温度，指尖能感受到那种刚刚好的温热。
窗外的鸽子拍打翅膀的声音突然变得很清晰，一下、两下，
然后消失在远处。我盯着屏幕上那行代码，突然意识到，
有些话一旦说出口就再也收不回来了。

早上七点半闹钟响的时候，我几乎是下意识地按掉它，
翻了个身继续睡。后来回想起来，那一刻的自己，
是不是已经预感到了今天会是这样的一天？

━━━

十点钟的会议室里，空调的声音像是某种背景噪音，
持续而单调。L 在讲话的时候，我注意到他咬了好几次嘴唇，
那是他紧张的时候才会有的小动作。我们都在假装轻松，
但空气里那种紧绷的感觉骗不了人。

> 也许这才是生活的本质——在无数个微小的选择中，
> 我们成为了现在的自己。而那些没说出口的话，
> 最终会变成什么样子呢？

夜深了。窗外的城市还亮着零星的灯光。
我想起下午那杯咖啡，想起鸽子的翅膀声，
想起...

算了，有些事情，留在心里也挺好的。
```

**改进点：**
- ✅ 从具体的瞬间开始（咖啡杯、鸽子声）
- ✅ 感官细节丰富（温度、声音、空气）
- ✅ 有内心冲突（说不说出口）
- ✅ 时间顺序打乱，更像真实的回忆
- ✅ 有留白和欲言又止
- ✅ 结尾不总结，思绪飘散

---

## 🎨 Prompt 工程核心原则

### 1. **叙事结构 - 故事弧线**
```
开场 → 转折 → 高潮 → 余韵
```

不要按时间顺序！可以：
- 从最触动的时刻开始
- 在现在与回忆间穿梭
- 某个片段戛然而止

### 2. **冰山理论 - 留白的艺术**

**海明威说：** 冰山在水面上的只有八分之一，真正的力量在水下。

应用到日记：
- 少说多显：通过细节暗示情绪
- 展现冲突：内心的矛盾和未解决的问题
- 欲言又止：某些话留到心里

### 3. **感官轰炸 - 五感写作**

每个场景必须有：

| 感官 | 具体做法 | 示例 |
|------|---------|------|
| 👁️ 视觉 | 光线、色彩、表情 | "下午三点的阳光是斜的，在桌面上投下长长的影子" |
| 👂 听觉 | 声音的质感 | "键盘敲击声像是雨点打在窗上" |
| 👃 嗅觉 | 最能唤起记忆 | "空气里还残留着早晨咖啡的焦香" |
| 👅 味觉 | 食物、情绪的味道 | "嘴里有种说不出的苦涩" |
| ✋ 触觉 | 质地、温度 | "指尖能感受到纸张微微的粗糙" |

### 4. **内心独白 - 真实的思考流**

**不要：** "我很开心，因为完成了任务。"

**要：** "任务完成的那一刻，我盯着屏幕，脑子里突然一片空白。应该开心的，对吧？但为什么会有种说不出的失落？"

特点：
- 意识流，不连贯
- 自我对话，质疑
- 从小事引申到哲思
- 敢于展现脆弱

### 5. **细节的力量**

**不要：** "下午去了咖啡店"

**要：** "下午三点四十七分，推开咖啡店的门，铃铛响了两声。靠窗的那个位置还空着，阳光正好落在椅背上。"

魔鬼在细节中：
- 具体的时刻（3:47 而非 下午）
- 具体的物件（某个杯子、某张椅子）
- 具体的话语（引号标记）
- 具体的动作（抓头发、咬嘴唇）

### 6. **情感的层次**

展现情感的复杂性：

```
表层：开心
深层：焦虑
更深层：对未来的不确定

此时此刻：兴奋
记忆联结：怀念
情感冲突：矛盾
```

---

## 🚫 禁止的陈词滥调

| ❌ 不要用 | ✅ 改用 |
|----------|--------|
| "充满了希望" | 具体描述希望的源头和感受 |
| "美好的一天" | 说出哪个瞬间让你觉得美好 |
| "时光飞逝" | 展现时间流逝的具体感受 |
| "感慨万千" | 说出你在感慨什么 |
| "收获颇丰" | 列举具体收获和触动点 |
| 教科书式总结 | 让思绪自然飘散 |

---

## 🤖 AI 模型选择

### 推荐：**GPT-4o** ✨

**为什么选择 GPT-4o？**

| 模型 | 创意写作 | 叙事能力 | 细节描写 | 成本 | 推荐度 |
|------|---------|---------|---------|------|--------|
| **GPT-4o** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 中 | ⭐⭐⭐⭐⭐ |
| GPT-4o-mini | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | 低 | ⭐⭐⭐⭐ |
| GPT-3.5-turbo | ⭐⭐ | ⭐⭐ | ⭐⭐ | 很低 | ⭐⭐ |
| Claude-3.5-Sonnet | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 中 | ⭐⭐⭐⭐⭐ |

**GPT-4o 的优势：**
- ✅ 理解复杂的创作指令
- ✅ 能够运用修辞和文学技巧
- ✅ 擅长情感细腻描写
- ✅ 能够模仿特定的写作风格
- ✅ 生成的内容不机械，有人味

**Claude-3.5-Sonnet 的优势：**
- ✅ 文学性更强，更有诗意
- ✅ 更擅长意识流写作
- ✅ 能够捕捉情感的微妙变化
- ⚠️ 但需要额外配置 Anthropic API

**温度参数：0.9**
- 创意写作需要高温度
- 允许更多意想不到的表达
- 避免机械化的模板输出

---

## 📊 Token 消耗分析

### 新版本 Prompt 成本

| 组成部分 | Token 数 | 说明 |
|---------|---------|------|
| 创作指导 | ~1200 | 传记大师技艺说明 |
| 关键时刻 | ~300 | 智能选择3-5个最有故事性的片段 |
| 内心活动 | ~100 | 对话摘要（最多2条） |
| 格式说明 | ~200 | Tiptap JSON 格式 |
| **输入总计** | **~1,800** | |
| **输出估算** | **~1,000** | 800-1200字日记 |
| **总 Token** | **~2,800** | |

### 成本计算 (GPT-4o)

```
输入：1,800 tokens × $2.50/1M = $0.0045
输出：1,000 tokens × $10.00/1M = $0.0100
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
总成本：约 $0.0145 (¥0.10)
```

✅ **成本依然可控！** 每次生成约 1 毛钱

### 对比旧版本

| 指标 | 旧版（时间线） | 新版（大师级） | 变化 |
|------|--------------|--------------|------|
| Prompt 复杂度 | 简单 | 复杂 | ↑ |
| Token 消耗 | ~1,850 | ~2,800 | +51% |
| 单次成本 | ¥0.07 | ¥0.10 | +43% |
| **内容质量** | ⭐⭐ | ⭐⭐⭐⭐⭐ | **+150%** |
| **阅读体验** | 枯燥 | 引人入胜 | **质的飞跃** |

**结论：** 成本增加 43%，但质量提升 150%+，**非常值得！**

---

## 🎯 预期效果

### 生成的日记将会：

✅ **有故事性** - 不是流水账，而是一个完整的故事  
✅ **有画面感** - 读者能够身临其境  
✅ **有情感张力** - 能够触动人心  
✅ **有思考深度** - 从生活到哲思的自然过渡  
✅ **真实不做作** - 像真人写的，不是 AI 模板  
✅ **可读性强** - 让人一读就停不下来  

### 示例对比

#### 场景：喝咖啡

**旧版：**
```
下午3点，我喝了一杯咖啡，味道不错。
```

**新版：**
```
下午三点四十七分，咖啡杯壁上还残留着温度。
我端起来的时候，注意到杯子上有个小小的缺口，
边缘有点粗糙，磨着嘴唇有种说不出的感觉。
咖啡已经有点凉了，但我还是一口气喝完了。
不是因为味道，而是需要一个理由，
一个暂停思考的理由。
```

---

## 🔧 技术实现

### 核心文件

```
src/lib/ai/diary/
├── prompts-master.ts       # 大师级 Prompt（NEW）
├── generator.ts            # AI 生成器（已更新）
├── sources.ts              # 数据源智能选择（已优化）
└── types.ts                # 类型定义
```

### 关键函数

#### 1. `generateMasterDiaryPrompt()`
```typescript
// 构建大师级 Prompt
// - 智能选择关键时刻（最有故事性的3-5个）
// - 提供详细的创作指导
// - 包含文学技巧说明
```

#### 2. `selectKeyMoments()`
```typescript
// 智能评分系统
// 评分维度：
// - 内容长度（20-100字最佳）
// - 情感词汇（开心、难过、惊讶等）
// - 行动词汇（去、看、听、说等）
```

#### 3. `generateDiaryContent()`
```typescript
// AI 调用
// - 模型：GPT-4o
// - 温度：0.9（高创意）
// - System prompt：传记作家角色设定
```

---

## 📝 使用方法

### 1. 生成日记

在日记页面点击"生成今日日记"，系统会：

1. 📊 收集今日数据（记录 + 对话）
2. 🎯 智能选择关键时刻（3-5个最有故事性的）
3. 🎨 构建大师级 Prompt
4. 🤖 调用 GPT-4o 创作
5. ✨ 返回精彩的日记

### 2. 查看效果

生成的日记会有：
- 🎭 开场即吸引人
- 🌈 丰富的感官细节
- 💭 真实的内心独白
- 🎬 故事化的叙事
- 🌊 自然飘散的结尾

### 3. 编辑优化

如果某些地方不满意：
- 可以直接在 Tiptap 编辑器中修改
- 也可以重新生成（每次都会有不同的角度）

---

## 🎓 写作技巧参考

### 开场技巧

❌ **不要：** "今天早上起床后..."

✅ **要：** 
- 从一个具体的瞬间开始
- 从一个强烈的感官体验开始
- 从一个疑问或冲突开始

**示例：**
```
凌晨三点，我被一个梦惊醒。
梦里的细节已经模糊了，
但那种心跳的感觉还留在胸口。
```

### 过渡技巧

❌ **不要：** "然后我就..."

✅ **要：**
- 用空间转换（"推开门的一瞬间..."）
- 用时间跳跃（"回到八小时前..."）
- 用思绪转折（"突然想起..."）

### 结尾技巧

❌ **不要：** "今天是充实的一天，期待明天。"

✅ **要：**
- 留下一个未完成的思考
- 留下一个欲言又止的情绪
- 回到开头的某个意象

**示例：**
```
夜深了。窗外的城市还亮着零星的灯光。
我想起下午那杯咖啡，想起...
算了，有些事情，留在心里也挺好的。
```

---

## 🚀 未来优化方向

### 短期（已完成）
- ✅ 大师级 Prompt 工程
- ✅ GPT-4o 模型集成
- ✅ 智能关键时刻选择

### 中期（可选）
- ⏳ 集成 Claude-3.5-Sonnet（更文学化）
- ⏳ 多种写作风格切换（海明威式、村上春树式等）
- ⏳ 用户写作风格学习

### 长期（可选）
- ⏳ 月度总结、年度回顾
- ⏳ 生成完整的个人传记
- ⏳ 情感轨迹可视化

---

## 🎉 总结

**旧系统：** 时间线流水账，机械罗列事件  
**新系统：** 世界级传记作家笔触，真实生动有冲击力

**成本：** ¥0.10/次（完全可控）  
**质量：** 质的飞跃 ⭐⭐⭐⭐⭐

**适合：** 想要记录生活，但不想写流水账的你

**核心理念：** 
> 生活不是一个个孤立的时刻，  
> 而是一条情感的河流。  
> 好的日记，应该能够捕捉这条河流的波动。

---

现在，让我们开始创作你的第一篇大师级日记吧！🎨✨

